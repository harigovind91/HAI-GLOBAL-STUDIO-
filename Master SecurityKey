from db import SessionLocal
from models import Journal

def add_entry(date, account, debit, credit, master_key=None):
    # सुरक्षा पहले!
    if master_key != "HAI_GLOBAL_ADMIN_2026":
        return "Error: Unauthorized. Invalid Master Security Key."

    db = SessionLocal()
    try:
        entry = Journal(
            date=date,
            account=account,
            debit=debit,
            credit=credit
        )
        db.add(entry)
        db.commit()
        db.refresh(entry) # डेटाबेस से ID वापस पाने के लिए
        return f"Success: Entry added for {account} with ID {entry.id}"
    
    except Exception as e:
        db.rollback() # अगर कुछ गड़बड़ हो तो ट्रांजैक्शन वापस ले लें
        return f"Database Error: {str(e)}"
    
    finally:
        db.close() # सेशन बंद करना कभी न भूलें!
